require(["esri/Map","esri/views/MapView","esri/widgets/Locate","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/Graphic","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","bootstrap/Dropdown","bootstrap/Collapse","calcite-maps/calcitemaps-v0.3","dojo/domReady!"],function(e,n,t,o,r,a,s,l,m,c,d){function u(e){C.removeAll();var n=e.results[0].graphic,t=n.attributes;console.log(t);var o=(t.Primary_Building_Name,new a({geometry:e.results[0].graphic.geometry,symbol:new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}})}));C.add(o);var i=[],r=[],s=t;for(var l in s)s.hasOwnProperty(l)&&"object"!=typeof s[l]&&("BottleFiller"!=l&&"CommonRoom"!=l&&"ComputerRoom"!=l&&"Elevator"!=l&&"GameTable"!=l&&"Kitchen"!=l&&"Laundry"!=l&&"MusicPracticeRoom"!=l&&"Printer"!=l&&"Special"!=l&&"StudyRoom"!=l&&"RecyclingCompostWasteDisposal"!=l&&"VendingMachines"!=l||"No"==s[l]||null==s[l]||i.push(l.split(/(?=[A-Z])/).join(" ")+": "+s[l]));for(var c in i)r.push(i[c].replace(": Yes",""));r.sort(),r.forEach(function(e,n){"Recycling Compost Waste Disposal"==e&&(r[n]="Recycling, Compost, and Waste Disposal")}),0==r.length?(document.getElementsByClassName("panel-label")[0].innerHTML="List of amenities:",document.getElementById("foo").innerHTML="",document.getElementById("foo").innerHTML="There are not amenities in this building!"):(document.getElementsByClassName("panel-label")[0].innerHTML="List of amenities:",document.getElementById("foo").innerHTML="",document.getElementById("foo").innerHTML=r.toString().replace(/,/g,", "))}function p(e){var n=T.createQuery();return"Special"==e?(n.where=e+" <> 'null'",T.queryFeatures(n)):(n.where=e+" = 'Yes'",T.queryFeatures(n))}function y(e){A.extent=new d({xmin:E,ymin:L,xmax:B,ymax:w,spatialReference:102100}),C.removeAll(),console.log(e);var n=e.features.map(function(e){return e.symbol=new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}}),e}),t=[];for(i=0;i<e.features.length;i++)t.push(e.features[i].attributes.Primary_Building_Name);t.forEach(function(e,n){"Recycling Compost Waste Disposal"==e&&(t[n]="Recycling, Compost, and Waste Disposal")}),document.getElementsByClassName("panel-label")[0].innerHTML="List of dormitories:",document.getElementById("foo").innerHTML=t.sort().toString().replace(/,/g,", "),C.addMany(n)}function g(e){var n=T.createQuery();return n.where="Primary_Building_Name = '"+e+"'",T.queryFeatures(n)}function f(e){C.removeAll();var n=e.features.map(function(e){return e.symbol=new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}}),e}),t=[],o=[],i=e.features[0].attributes;for(var r in i)console.log(r),i.hasOwnProperty(r)&&"object"!=typeof i[r]&&("BottleFiller"!=r&&"CommonRoom"!=r&&"ComputerRoom"!=r&&"Elevator"!=r&&"GameTable"!=r&&"Kitchen"!=r&&"Laundry"!=r&&"MusicPracticeRoom"!=r&&"Printer"!=r&&"Special"!=r&&"StudyRoom"!=r&&"RecyclingCompostWasteDisposal"!=r&&"VendingMachines"!=r||"No"==i[r]||null==i[r]||t.push(r.split(/(?=[A-Z])/).join(" ")+": "+i[r]));for(var a in t)o.push(t[a].replace(": Yes",""));o.forEach(function(e,n){"Recycling Compost Waste Disposal"==e&&(o[n]="Recycling, Compost, and Waste Disposal")}),0==o.length?(document.getElementsByClassName("panel-label")[0].innerHTML="List of amenities:",document.getElementById("foo").innerHTML="",document.getElementById("foo").innerHTML="There are not amenities in this building!"):(document.getElementsByClassName("panel-label")[0].innerHTML="List of amenities:",document.getElementById("foo").innerHTML="",document.getElementById("foo").innerHTML=o.toString().replace(/,/g,", ")),C.addMany(n)}var h=17,v=-71.116076,b=42.37375,B=-7915458.81211143,E=-7917751.9229597915,w=5217414.497463334,L=5216847.191394078,M={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return M.Android()||M.BlackBerry()||M.iOS()||M.Opera()||M.Windows()}};M.any()&&(h=16,v=-71.116286,b=42.37175,B=-7916229.045165166,E=-7917088.961733397,w=5217530.483504136,L=5216121.17579509);var R=new s({symbol:new m({color:[0,137,252,.4],style:"solid",outline:{width:1,color:"blue"}})}),T=new o({url:"https://map.harvard.edu/arcgis/rest/services/FDO/fdo/MapServer/0",outFields:["*"],visible:!0,renderer:R}),C=new r,I=new e({basemap:"topo",layers:[T,C]}),A=new n({container:"mapViewDiv",map:I,center:[v,b],zoom:h,padding:{top:50,bottom:0},breakpoints:{xsmall:768,small:769,medium:992,large:1200}});A.constraints={rotationEnabled:!1};var S=new t({view:A});A.ui.add(S,{position:"top-left"}),A.on("click",function(e){document.getElementById("infoAmenities").options[0].selected=!0;var n=e.screenPoint;A.hitTest(n).then(u)}),document.getElementById("alert_placeholder").addEventListener("click",function(){this.style.visibility="hidden"});var x=document.getElementById("infoAmenities");x.addEventListener("change",function(){p(x.options[x.selectedIndex].value).then(y),document.getElementById("infoDorms").options[0].selected=!0});var D=document.getElementById("infoDorms");D.addEventListener("change",function(){A.extent=new d({xmin:E,ymin:L,xmax:B,ymax:w,spatialReference:102100}),g(D.options[D.selectedIndex].value).then(f),document.getElementById("infoAmenities").options[0].selected=!0})});