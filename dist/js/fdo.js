require(["esri/Map","esri/views/MapView","esri/widgets/Locate","esri/layers/FeatureLayer","esri/layers/GraphicsLayer","esri/Graphic","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","esri/widgets/Popup","bootstrap/Dropdown","bootstrap/Collapse","calcite-maps/calcitemaps-v0.3","dojo/domReady!"],function(e,t,r,n,o,u,i,a,m,s,l,d){var c=17,p=-71.116076,y=42.37305,g=-7915458.81211143,v=-7917751.9229597915,f=5217414.497463334,h=5216847.191394078,w={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return w.Android()||w.BlackBerry()||w.iOS()||w.Opera()||w.Windows()}};w.any()&&(c=16,p=-71.116286,y=42.37175,g=-7916229.045165166,v=-7917088.961733397,f=5217530.483504136,h=5216121.17579509);var b=new n({url:"https://map.harvard.edu/arcgis/rest/services/fdo/fdo/MapServer",outFields:["*"],visible:!0,renderer:new i({symbol:new m({color:[0,137,252,.4],style:"solid",outline:{width:1,color:"blue"}})})}),x=new o,A=new t({container:"mapViewDiv",map:new e({basemap:"topo",layers:[b,x]}),center:[p,y],zoom:c,padding:{top:50,bottom:0},breakpoints:{xsmall:768,small:769,medium:992,large:1200}});A.constraints={rotationEnabled:!1};var E=new r({view:A});function B(e){x.removeAll();for(var t=e.results[0].graphic.attributes,r=t.Primary_Building_Name,n=document.getElementById("infoDorms"),o=0;o<n.options.length;o++)if(n.options[o].value===r){n.selectedIndex=o;break}var i=new u({geometry:e.results[0].graphic.geometry,symbol:new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}})});x.add(i);var a=document.createElement("ul"),s=t;for(var o in s)if("Yes"==s[o]){var l=document.createElement("li");l.appendChild(document.createTextNode(o.split(/(?=[A-Z])/).join(" "))),a.appendChild(l)}var d="<div><img width='300px' src='https://map.harvard.edu/images/bldg_photos/"+t.url+"'</img><p>"+t.Notes+"</p><p>"+a.outerHTML+"</p></div>";A.popup.open({title:t.Dorm_Name,content:d})}A.ui.add(E,{position:"top-left"}),A.on("click",function(e){e.stopPropagation(),document.getElementById("alert_placeholder").style.display="none",document.getElementById("infoAmenities").options[0].selected=!0;var t=e.screenPoint;A.popup.location=e.mapPoint,A.hitTest(t).then(B)});var I=document.getElementById("infoAmenities");function M(e){A.extent=new l({xmin:v,ymin:h,xmax:g,ymax:f,spatialReference:102100}),x.removeAll();var t=e.features.map(function(e){return e.symbol=new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}}),e});x.addMany(t)}I.addEventListener("change",function(){var e,t,r=I.options[I.selectedIndex].value;(e=r,t=b.createQuery(),t.where=e+" = 'Yes'",b.queryFeatures(t)).then(M),document.getElementById("infoDorms").options[0].selected=!0,A.popup.visible=!1});var P=document.getElementById("infoDorms");function D(e){x.removeAll();var t=e.features.map(function(e){return e.symbol=new m({color:[255,0,0,.6],style:"solid",outline:{color:"red",width:2}}),e}),r=document.createElement("ul"),n=e.features[0].attributes;for(var o in n)if("Yes"==n[o]){var i=document.createElement("li");i.appendChild(document.createTextNode(o.split(/(?=[A-Z])/).join(" "))),r.appendChild(i)}var a="<div><img width='300px' src='https://map.harvard.edu/images/bldg_photos/"+e.features[0].attributes.url+"'</img><p>"+e.features[0].attributes.Notes+"</p><p>"+r.outerHTML+"</p></div>";A.center=[e.features[0].geometry.centroid.longitude,e.features[0].geometry.centroid.latitude],A.popup.open({title:e.features[0].attributes.Dorm_Name,content:a,updateLocationEnabled:!0,location:A.center}),x.addMany(t)}P.addEventListener("change",function(){console.log("Dorm change"),A.popup.clear(),A.extent=new l({xmin:v,ymin:h,xmax:g,ymax:f,spatialReference:102100});var e,t,r=P.options[P.selectedIndex].value;(e=r,t=b.createQuery(),t.where="Primary_Building_Name = '"+e+"'",b.queryFeatures(t)).then(D),document.getElementById("infoAmenities").options[0].selected=!0})});